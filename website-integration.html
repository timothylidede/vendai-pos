<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VendAI POS - Download</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .download-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .version-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 40px;
        }

        .version-number {
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .release-date {
            color: #666;
            font-size: 0.9rem;
        }

        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .download-card {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 30px 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .download-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .os-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .windows .os-icon {
            background: #0078d4;
            color: white;
        }

        .macos .os-icon {
            background: #000;
            color: white;
        }

        .linux .os-icon {
            background: #FCC624;
            color: #333;
        }

        .os-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .download-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .download-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .download-btn:hover {
            background: #5a6fd8;
            transform: scale(1.05);
        }

        .download-btn.secondary {
            background: #6c757d;
        }

        .download-btn.secondary:hover {
            background: #5a6268;
        }

        .system-requirements {
            background: #e8f4f8;
            border-radius: 12px;
            padding: 20px;
            margin-top: 40px;
            text-align: left;
        }

        .system-requirements h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .system-requirements ul {
            list-style: none;
            padding: 0;
        }

        .system-requirements li {
            color: #666;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .system-requirements li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .loading {
            color: #666;
            font-style: italic;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .download-container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .download-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="download-container">
        <div class="logo">V</div>
        <h1>VendAI POS</h1>
        <p class="subtitle">AI-Powered Point of Sale System</p>
        
        <div class="version-info" id="version-info">
            <div class="loading">Loading latest version...</div>
        </div>

        <div class="download-grid" id="download-grid">
            <!-- Downloads will be populated by JavaScript -->
        </div>

        <div class="system-requirements">
            <h3>System Requirements</h3>
            <ul>
                <li><strong>Windows:</strong> Windows 10 or later (64-bit)</li>
                <li><strong>macOS:</strong> macOS 10.15 (Catalina) or later</li>
                <li><strong>Linux:</strong> Ubuntu 18.04+ or equivalent distribution</li>
                <li><strong>Memory:</strong> 4GB RAM minimum, 8GB recommended</li>
                <li><strong>Storage:</strong> 500MB available space</li>
                <li><strong>Internet:</strong> Required for initial setup and updates</li>
            </ul>
        </div>
    </div>

    <script>
        // Auto-detect user's operating system
        function detectOS() {
            const userAgent = window.navigator.userAgent;
            const platform = window.navigator?.userAgentData?.platform || window.navigator.platform;
            const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K', 'macOS'];
            const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];

            if (macosPlatforms.indexOf(platform) !== -1) {
                return 'macos';
            } else if (windowsPlatforms.indexOf(platform) !== -1) {
                return 'windows';
            } else if (/Linux/.test(platform)) {
                return 'linux';
            }
            return 'unknown';
        }

        // Fetch latest release from our API
        async function fetchLatestRelease() {
            try {
                const response = await fetch('https://vendai-nzd6u7wvp-vendais-projects.vercel.app/api/releases/latest');
                if (!response.ok) throw new Error('Failed to fetch release info');
                return await response.json();
            } catch (error) {
                console.error('Error fetching release:', error);
                return null;
            }
        }

        // Filter and organize download assets
        function organizeAssets(assets) {
            const organized = {
                windows: [],
                macos: [],
                linux: []
            };

            assets.forEach(asset => {
                const name = asset.name.toLowerCase();
                if (name.includes('windows') || name.includes('win') || name.endsWith('.exe')) {
                    organized.windows.push(asset);
                } else if (name.includes('macos') || name.includes('mac') || name.endsWith('.dmg')) {
                    organized.macos.push(asset);
                } else if (name.includes('linux') || name.endsWith('.appimage') || name.endsWith('.deb') || name.endsWith('.rpm')) {
                    organized.linux.push(asset);
                }
            });

            return organized;
        }

        // Create download card HTML
        function createDownloadCard(platform, assets, isRecommended = false) {
            const icons = {
                windows: '🪟',
                macos: '🍎',
                linux: '🐧'
            };

            const names = {
                windows: 'Windows',
                macos: 'macOS',
                linux: 'Linux'
            };

            if (!assets || assets.length === 0) return '';

            const primaryAsset = assets.find(a => 
                a.name.includes('Setup') || 
                a.name.includes('.dmg') || 
                a.name.includes('AppImage')
            ) || assets[0];

            const secondaryAssets = assets.filter(a => a !== primaryAsset);

            const recommendedBadge = isRecommended ? '<span style="color: #28a745; font-size: 0.8rem; font-weight: bold;">✓ Detected</span>' : '';

            return `
                <div class="download-card ${platform}" onclick="window.open('${primaryAsset.browser_download_url}', '_blank')">
                    <div class="os-icon">${icons[platform]}</div>
                    <div class="os-name">${names[platform]} ${recommendedBadge}</div>
                    <div class="download-options">
                        <a href="${primaryAsset.browser_download_url}" class="download-btn" onclick="event.stopPropagation()">
                            Download ${primaryAsset.name.includes('Setup') ? 'Installer' : primaryAsset.name.includes('.dmg') ? 'DMG' : 'AppImage'}
                        </a>
                        ${secondaryAssets.map(asset => `
                            <a href="${asset.browser_download_url}" class="download-btn secondary" onclick="event.stopPropagation()">
                                ${asset.name.includes('Portable') ? 'Portable Version' : 
                                  asset.name.includes('.zip') ? 'ZIP Archive' : 
                                  asset.name.includes('.deb') ? 'DEB Package' :
                                  asset.name.includes('.rpm') ? 'RPM Package' : 'Alternative'}
                            </a>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Initialize the download page
        async function initializeDownloadPage() {
            const versionInfo = document.getElementById('version-info');
            const downloadGrid = document.getElementById('download-grid');
            const userOS = detectOS();

            const release = await fetchLatestRelease();
            
            if (!release) {
                versionInfo.innerHTML = '<div class="error">Unable to fetch release information. Please try again later.</div>';
                return;
            }

            // Update version info
            const releaseDate = new Date(release.published_at).toLocaleDateString();
            versionInfo.innerHTML = `
                <div class="version-number">Version ${release.tag_name}</div>
                <div class="release-date">Released on ${releaseDate}</div>
            `;

            // Organize and display downloads
            const organizedAssets = organizeAssets(release.assets);
            
            let downloadHTML = '';
            
            // Prioritize user's detected OS
            const platformOrder = userOS === 'unknown' ? ['windows', 'macos', 'linux'] : 
                                 [userOS, ...['windows', 'macos', 'linux'].filter(p => p !== userOS)];

            platformOrder.forEach(platform => {
                if (organizedAssets[platform].length > 0) {
                    downloadHTML += createDownloadCard(platform, organizedAssets[platform], platform === userOS);
                }
            });

            downloadGrid.innerHTML = downloadHTML;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDownloadPage);
    </script>
</body>
</html>